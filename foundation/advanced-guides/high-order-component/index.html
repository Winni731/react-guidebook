<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/react-guidebook/umi.css" />
    <script>
      window.routerBase = "/react-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>高阶组件</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//">React Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a aria-current="page" class="active" href="/react-guidebook//foundation">基础</a><a href="/react-guidebook//architect">架构</a><a href="/react-guidebook//ecosystem">生态</a><a href="/react-guidebook//api-reference">API</a><a href="/react-guidebook//hooks">Hooks</a><a href="/react-guidebook//extensions">扩展</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//"></a><h1>React Guidebook</h1><p>React 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/react-guidebook//foundation">基础</a></li><li><a href="/react-guidebook//architect">架构</a></li><li><a href="/react-guidebook//ecosystem">生态</a></li><li><a href="/react-guidebook//api-reference">API</a></li><li><a href="/react-guidebook//hooks">Hooks</a></li><li><a href="/react-guidebook//extensions">扩展</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/react-guidebook//foundation/main-concepts">基础概念</a><ul><li><a href="/react-guidebook//foundation/main-concepts/overview"><span>特性</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/jsx"><span>JSX</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/state"><span>State</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/props"><span>Props</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/component"><span>组件化</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/lifecycle"><span>生命周期</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/react-dom"><span>组件挂载器</span></a></li></ul></li><li><a aria-current="page" class="active" href="/react-guidebook//foundation/advanced-guides">进阶指引</a><ul><li><a href="/react-guidebook//foundation/advanced-guides/render"><span>render</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/set-state"><span>setState</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/handling-events"><span>事件机制</span></a></li><li><a aria-current="page" class="active" href="/react-guidebook//foundation/advanced-guides/high-order-component"><span>高阶组件</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/render-props"><span>Render Props</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/refs"><span>Refs</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/context"><span>Context</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/portals"><span>Portals</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/profiler"><span>Profiler</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/error-boundaries"><span>错误边界</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="属性代理" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#属性代理"><span>属性代理</span></a></li><li title="默认参数" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#默认参数"><span>默认参数</span></a></li><li title="通过 Refs 使用引用" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#通过-refs-使用引用"><span>通过 Refs 使用引用</span></a></li><li title="抽象状态" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#抽象状态"><span>抽象状态</span></a></li><li title="包裹组件" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#包裹组件"><span>包裹组件</span></a></li><li title="反向继承" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#反向继承"><span>反向继承</span></a></li><li title="渲染劫持" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#渲染劫持"><span>渲染劫持</span></a></li><li title="操作状态" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#操作状态"><span>操作状态</span></a></li><li title="应用场景" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#应用场景"><span>应用场景</span></a></li><li title="权限控制" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#权限控制"><span>权限控制</span></a></li><li title="性能监控" data-depth="3" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#性能监控"><span>性能监控</span></a></li><li title="注意事项" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/high-order-component#注意事项"><span>注意事项</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="高阶组件"><a aria-hidden="true" href="#高阶组件"><span class="icon icon-link"></span></a>高阶组件</h1><p>高阶组件（High-Order Component）接受 React 组件作为输入，输出一个新的 React 组件。</p><ul><li>高阶组件不是组件，是增强函数，可以输入一个元组件，输出一个新的增强组件</li><li>高阶组件的主要作用是代码复用，操作状态和参数</li></ul><p><strong>实现高阶组件的方法：</strong></p><ul><li><a href="#%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86">属性代理</a>（props proxy）。高阶组件通过被包裹的 React 组件来操作 <code>props</code>。</li><li><a href="#%E5%8F%8D%E5%90%91%E7%BB%A7%E6%89%BF">反向继承</a>（inheritance inversion）。高阶组件继承于被包裹的 React 组件。</li></ul><h2 id="属性代理"><a aria-hidden="true" href="#属性代理"><span class="icon icon-link"></span></a>属性代理</h2><p><strong>属性代理</strong>（Props Proxy）：输出一个组件，它基于被包裹组件进行 <strong>功能增强</strong>。</p><p>🌰 <strong>示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import React from &#x27;react&#x27;;

const MyContainer = WrappedComponent =&gt;
  class extends Component {
    render() {
      return &lt;WrapperdComponent {...this.props} /&gt;;
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> React </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> Component </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">WrapperdComponent</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread punctuation">...</span><span class="token tag spread attr-value">this</span><span class="token tag spread punctuation">.</span><span class="token tag spread attr-value">props</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这里的高阶组件中采用了匿名类通过 <code>render</code> 方法返回传入的 React 组件（WrappedComponent）。通过高阶组件传递 <code>props</code>，这种方式即为 <strong>属性代理</strong>。</p><p>这样组件就可以一层层地作为参数被调用，原始组件就具备了高阶组件对它的修饰。就这么简单，保持单个组件封装性的同时还保留了易用性。</p><h3 id="默认参数"><a aria-hidden="true" href="#默认参数"><span class="icon icon-link"></span></a>默认参数</h3><p><strong>默认参数</strong>：可以为组件包裹一层默认参数。</p><p>我们可以读取、增加、编辑或是移除从原组件（WrappedComponent）传进来的 <code>props</code>，但需要小心删除与编辑重要的 <code>props</code>。我们应该尽可能对高阶组件的 <code>props</code> 作新的命名以防止混淆。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import React from &#x27;react&#x27;;

const MyContainer = WrappedComponent =&gt;
  class extends React.Component {
    render() {
      const newProps = {
        name: nextName,
      };
      return &lt;WrappedComponent {...this.props} {...newProps} /&gt;;
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> newProps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation">:</span><span class="token plain"> nextName</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">newProps</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>当调用高阶组件时，可以使用新的 props name 了。对于原组件来说，只要套用这个高阶组件，我们的新组件中就会多一个 name 的 props。</p><h3 id="通过-refs-使用引用"><a aria-hidden="true" href="#通过-refs-使用引用"><span class="icon icon-link"></span></a>通过 Refs 使用引用</h3><p>在高阶组件中，我们可以接受 Refs 使用原组件（WrappedComponent）的引用。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import React from &#x27;react&#x27;;

const MyContainer = WrappedComponent =&gt;
  class extends React.Component {
    proc(wrappedComponentInstance) {
      wrappedComponentInstantce.mdethod();
    }
    render() {
      const props = Object.assign({}, this.props, {
        ref: this.proc.bind(this),
      });
      return &lt;WrappedComponent {...props} /&gt;;
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">proc</span><span class="token punctuation">(</span><span class="token parameter">wrappedComponentInstance</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      wrappedComponentInstantce</span><span class="token punctuation">.</span><span class="token method function property-access">mdethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> props </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">proc</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">props</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>当原组件（WrappedComponent）被渲染时，Refs 回调函数就会被执行，这样就会拿到一份原组件（WrappedComponent）实例的引用。这就可以方便地用于读取或增加实例的 Props，并调用实例的方法。</p><h3 id="抽象状态"><a aria-hidden="true" href="#抽象状态"><span class="icon icon-link"></span></a>抽象状态</h3><p>我们可以通过原组件（WrappedComponent）提供的 <code>props</code> 和回调函数抽象 State。</p><p>高阶组件可以将原组件抽象为展示型组件，分离内部状态。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import React from &#x27;react&#x27;;

const MyContainer = WrappedCompoenent =&gt;
  class extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        name: &#x27;&#x27;,
      };
      this.onNameChange = this.onNameChange.bind(this);
    }
    onNameChange(event) {
      this.setState({
        name: event.target.value,
      });
    }
    render() {
      const newProps = {
        name: {
          value: this.state.name,
          onChange: this.onNameChange,
        },
      };
      return &lt;WrappedCompoennt {...this.props} {...newProps} /&gt;;
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedCompoenent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onNameChange</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onNameChange</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">onNameChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> newProps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          onChange</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onNameChange</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">WrappedCompoennt</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">newProps</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const nameInput = props =&gt; (&lt;input name=&#x27;name&#x27; {...props}) /&gt;)
export default MyContainer(nameInput);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">nameInput</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">props</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">input name</span><span class="token operator">=</span><span class="token string">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">props</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token function maybe-class-name">MyContainer</span><span class="token punctuation">(</span><span class="token plain">nameInput</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在这个例子中，我们把 <code>input</code> 组件中对 <code>name prop</code> 的 <code>onChange</code> 方法提取到高阶组件中，这样</p><p>就有效地抽象了同样的状态操作。</p><h3 id="包裹组件"><a aria-hidden="true" href="#包裹组件"><span class="icon icon-link"></span></a>包裹组件</h3><p>此外，我们还可以使用其他元素来包裹原组件（WrappedComponent），这既可以是为了加样式，也可以是为了布局。</p><p>🌰 <strong>示例：增加一层定义样式</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import React, { Component } from &#x27;react&#x27;

const MyContainer = (WrappedCompoennt) =&gt;
     class extends Component {
         render() {
             return {
                 &lt;div style={{display: &#x27;block&#x27;}}&gt;
                     &lt;WrappedComponent {...this.props} /&gt;
                 &lt;/div&gt;
             }
         }
     }
" data-status="copy"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">WrappedCompoennt</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">         </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">             </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                 </span><span class="token operator">&lt;</span><span class="token plain">div style</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token plain">display</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;block&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                     </span><span class="token operator">&lt;</span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                 </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">             </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">         </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="反向继承"><a aria-hidden="true" href="#反向继承"><span class="icon icon-link"></span></a>反向继承</h2><p><strong>反向继承（Inheritance Inversion）</strong>：输出一个组件，继承于被包裹组件。</p><p>这种方式返回的 React 组件继承了被传入的组件，所以它能够访问到的区域、权限更多，相比属性代理方式，它更像打入组织内部，对其进行修改。</p><p>🌰 <strong>示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const MyContainer = WrappedCompoenent =&gt;
  class extends WrappedComponent {
    render() {
      return super.render();
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedCompoenent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>正如所见，高阶组件返回的组件继承于原组件 <code>&lt;WrappedComponent&gt;</code>。因为被动地继承了 <code>&lt;WrappedComponent&gt;</code>，所有的调用都会反向，这也是这种方法的由来。</p><p>这种方法与属性代理不太一样。它通过继承 <code>&lt;WrappedComponent&gt;</code> 来实现，方法可以通过 <code>super</code> 来顺序调用。因为依赖于继承的机制，HOC 的调用顺序和队列是一样的：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="didmount =&gt; HOC didmount =&gt; (HOCs didmount) =&gt; will unmount =&gt; HOC will unmount =&gt; (HOCs will unmount)
" data-status="copy"></button><div class="token-line"><span class="token parameter">didmount</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token constant">HOC</span><span class="token plain"> </span><span class="token parameter">didmount</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">HOCs didmount</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> will </span><span class="token parameter">unmount</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token constant">HOC</span><span class="token plain"> will </span><span class="token parameter">unmount</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token maybe-class-name">HOCs</span><span class="token plain"> will unmount</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在反向继承方法中，高阶组件可以使用原组件 <code>&lt;WrappedComponent&gt;</code> 引用，这意味着它可以使用原组件 <code>&lt;WrappedComponent&gt;</code> 的 <code>state</code> 、 <code>props</code> 、生命周期和 <code>render</code> 方法。但它不能保证完整的子组件树被解析。</p><h3 id="渲染劫持"><a aria-hidden="true" href="#渲染劫持"><span class="icon icon-link"></span></a>渲染劫持</h3><p>渲染劫持指的就是高阶组件可以控制原组件 <code>&lt;WrappedComponent&gt;</code> 的渲染过程，并渲染各种各样的结果。我们可以在这个过程中在任何 React 元素输出的结果中读取、增加、修改、删除 <code>props</code>，或读取或修改 React 元素树，或条件显示元素树，又或是用样式控制包裹元素树。</p><p>正如之前说到的，反向继承不能保证完整的子组件树被解析，这意味着将限制渲染劫持功能。 渲染劫持的经验法则是我们可以操控原组件 <code>&lt;WrappedComponent&gt;</code> 的元素树，并输出正确的结果。但如果元素树中包括了函数类型的 React 组件，就不能操作组件的子组件。</p><h4 id="条件渲染"><a aria-hidden="true" href="#条件渲染"><span class="icon icon-link"></span></a>条件渲染</h4><p><strong>条件渲染</strong>：根据条件，渲染不同的组件。</p><p>🌰 <strong>示例：条件渲染</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const MyContainer = WrappedComponent =&gt;
  class extends WrappedComponent {
    render() {
      if (this.props.loggedIn) {
        return super.render();
      } else {
        return null;
      }
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">loggedIn</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="修改渲染"><a aria-hidden="true" href="#修改渲染"><span class="icon icon-link"></span></a>修改渲染</h4><p><strong>修改渲染</strong>：可以直接修改被包裹组件渲染出的 React 元素树。</p><p>🌰 <strong>示例：修改渲染</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const MyContainer = WrappedComponent =&gt;
  class extends WrappedComponent {
    render() {
      const elementsTree = super.render();
      let newProps = {};
      if (elementsTree &amp;&amp; elementsTree.type === &#x27;input&#x27;) {
        newProps = { value: &#x27;may the force be with you&#x27; };
      }
      const props = Object.assign({}, elementsTree.props, newProps);
      const newElementsTree = React.cloneElement(elementsTree, props, elementsTree.props.children);
      return newElementsTree;
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> elementsTree </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">let</span><span class="token plain"> newProps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">elementsTree </span><span class="token operator">&amp;&amp;</span><span class="token plain"> elementsTree</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        newProps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> value</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;may the force be with you&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> props </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> elementsTree</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"> newProps</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> newElementsTree </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token method function property-access">cloneElement</span><span class="token punctuation">(</span><span class="token plain">elementsTree</span><span class="token punctuation">,</span><span class="token plain"> props</span><span class="token punctuation">,</span><span class="token plain"> elementsTree</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> newElementsTree</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="操作状态"><a aria-hidden="true" href="#操作状态"><span class="icon icon-link"></span></a>操作状态</h3><p>高阶组件可以读取、修改或删除原组件 WrappedComponent 实例中的 State，如果需要的话，也可以增加 State。但这样做，可能会使原组件 WrappedComponent 内部状态变得难以追踪，不易维护。大部分的高阶组件都应该限制读取或增加 State，尤其是后者，可以通过重新命名 State，以防止混淆。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const MyContainer = WrappedComponent =&gt;
  class extends WrappedComponent {
    render() {
      return (
        &lt;div&gt;
          &lt;h2&gt;HOC Debugger Component&lt;/h2&gt;
          &lt;p&gt;Props&lt;/p&gt;
          &lt;pre&gt;{JSON.stringify(this.props, null, 2)}&lt;/pre&gt;
          &lt;p&gt;State&lt;/p&gt;
          &lt;pre&gt;{JSON.stringify(this.state, null, 2)}&lt;/pre&gt;
          {super.render()}
        &lt;/div&gt;
      );
    }
  };
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">MyContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token plain">h2</span><span class="token operator">&gt;</span><span class="token constant">HOC</span><span class="token plain"> </span><span class="token maybe-class-name">Debugger</span><span class="token plain"> </span><span class="token maybe-class-name">Component</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">h2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token maybe-class-name">Props</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token plain">pre</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">pre</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token maybe-class-name">State</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token plain">pre</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">pre</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="应用场景"><a aria-hidden="true" href="#应用场景"><span class="icon icon-link"></span></a>应用场景</h2><h3 id="权限控制"><a aria-hidden="true" href="#权限控制"><span class="icon icon-link"></span></a>权限控制</h3><p><strong>权限控制</strong>：通过抽象逻辑，统一对页面进行权限判断，按不同的条件进行页面渲染。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const auth = (WrappedComponent) =&gt; {
    return class extends React.Component {
        constructor(props){
            super(props);
            this.state = {
                isAdmin: false
            }
        }
        async componentWillMount(){
            const currentRole = await getCurrentUserRole();
            this.setState({
                isAdmin: currentRole === &#x27;Admin&#x27;;
            })
        }
        render(){
            if(this.state.isAdmint){
                return &lt;WrapperdComponent {...this.props} /&gt;
            } else {
                return (&lt;div&gt;您没有权限查看该页面，请联系管理员！&lt;/div&gt;)
            }
        }
    }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">auth</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                isAdmin</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">const</span><span class="token plain"> currentRole </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">getCurrentUserRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                isAdmin</span><span class="token punctuation">:</span><span class="token plain"> currentRole </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;Admin&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">isAdmint</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">WrapperdComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">this</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain">您没有权限查看该页面，请联系管理员！</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="性能监控"><a aria-hidden="true" href="#性能监控"><span class="icon icon-link"></span></a>性能监控</h3><p><strong>性能监控</strong>：包裹组件的生命周期，进行统一埋点。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const performance = WrappedComponent =&gt; {
  return class extends WrappedComponent {
    constructor(props) {
      super(props);
      this.start = Date.now();
      this.end = 0;
    }
    componentDidMount() {
      super.componentDidMount &amp;&amp; super.componentDidMount();
      this.end = Date.now();
      console.log(`${WrappedComponent.name} 组件渲染时间为 ${this.end - this.state} ms`);
    }
    render() {
      return super.render();
    }
  };
};
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">performance</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">extends</span><span class="token plain"> </span><span class="token maybe-class-name">WrappedComponent</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">start</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">end</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token property-access">componentDidMount</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token method function property-access">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">end</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">WrappedComponent</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> 组件渲染时间为 </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation keyword">this</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">end </span><span class="token template-string interpolation operator">-</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation keyword">this</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation">state</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> ms</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="注意事项"><a aria-hidden="true" href="#注意事项"><span class="icon icon-link"></span></a>注意事项</h2><ul><li><strong>纯函数</strong>：增强函数应为纯函数，避免侵入修改元组件；</li><li><strong>避免用法污染</strong>：理想状态下，应透传元组件的无关参数与事件，尽量保证用法不变；</li><li><strong>命名空间</strong>：为 HOC 增加特异的组件名称，这样能便于开发调试和查找问题；</li><li><strong>引用传递</strong>：如果需要传递元组件的 refs 引用，可以使用 <code>React.forwardRef</code>；</li><li><strong>静态方法</strong>：元组件上的静态方法并无法被自动传出，会导致业务层无法调用，因此需要通过函数导出或者静态方法赋值两种方法解决；</li><li><strong>重新渲染</strong>：由于增强函数每次调用是返回一个新组件，因此如果在 Render 中使用增强函数，就会导致每次都重新渲染整个 HOC，而且之前的状态会丢失；</li></ul><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://juejin.im/post/5c92f499f265da612647b754" target="_blank" rel="noopener noreferrer">📝 中高级前端大厂面试秘籍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://juejin.im/post/5b837692f265da434015865a" target="_blank" rel="noopener noreferrer">📝 从 0 到 1 实现 React 系列—— HOC 探秘<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://zhuanlan.zhihu.com/p/49485308" target="_blank" rel="noopener noreferrer">📝 深入理解 React 高阶组件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/React-GuideBook/edit/master/docs/foundation/advanced-guides/high-order-component.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/1/2020, 6:20:53 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/react-guidebook/umi.js"></script>
    <script src="/react-guidebook/docs__foundation__advanced-guides__high-order-component.md.js"></script>
  </body>
</html>
