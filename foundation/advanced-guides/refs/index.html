<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/react-guidebook/umi.css" />
    <script>
      window.routerBase = "/react-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>Refs</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//">React Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a aria-current="page" class="active" href="/react-guidebook//foundation">基础</a><a href="/react-guidebook//architect">架构</a><a href="/react-guidebook//ecosystem">生态</a><a href="/react-guidebook//api-reference">API</a><a href="/react-guidebook//hooks">Hooks</a><a href="/react-guidebook//extensions">扩展</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//"></a><h1>React Guidebook</h1><p>React 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/react-guidebook//foundation">基础</a></li><li><a href="/react-guidebook//architect">架构</a></li><li><a href="/react-guidebook//ecosystem">生态</a></li><li><a href="/react-guidebook//api-reference">API</a></li><li><a href="/react-guidebook//hooks">Hooks</a></li><li><a href="/react-guidebook//extensions">扩展</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/react-guidebook//foundation/main-concepts">基础概念</a><ul><li><a href="/react-guidebook//foundation/main-concepts/overview"><span>特性</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/jsx"><span>JSX</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/state"><span>State</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/props"><span>Props</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/component"><span>组件化</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/lifecycle"><span>生命周期</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/react-dom"><span>组件挂载器</span></a></li></ul></li><li><a aria-current="page" class="active" href="/react-guidebook//foundation/advanced-guides">进阶指引</a><ul><li><a href="/react-guidebook//foundation/advanced-guides/render"><span>render</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/set-state"><span>setState</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/handling-events"><span>事件机制</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/high-order-component"><span>高阶组件</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/render-props"><span>Render Props</span></a></li><li><a aria-current="page" class="active" href="/react-guidebook//foundation/advanced-guides/refs"><span>Refs</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/context"><span>Context</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/portals"><span>Portals</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/profiler"><span>Profiler</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/error-boundaries"><span>错误边界</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="使用场景" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/refs#使用场景"><span>使用场景</span></a></li><li title="实用价值" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/refs#实用价值"><span>实用价值</span></a></li><li title="注意事项" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/refs#注意事项"><span>注意事项</span></a></li><li title="原理机制" data-depth="2" class=""><a href="/react-guidebook//foundation/advanced-guides/refs#原理机制"><span>原理机制</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="refs"><a aria-hidden="true" href="#refs"><span class="icon icon-link"></span></a>Refs</h1><p>React 的核心思想是每次对于变更 <code>props</code> 或 <code>state</code>，触发新旧 Virtual DOM 进行 diff（协调算法），对比出变化的地方，然后通过 render 重新渲染界面。</p><p>而 Refs 为我们提供了一种绕过状态更新和重新渲染时访问元素的方法，这在某些用例中很有用，但不应该作为 <code>props</code> 和 <code>state</code> 的替代方法。</p><p>在项目开发中，如果我们可以使用声明式或提升 <code>state</code> 所在的组件层级（状态提升）的方法来更新组件，最好不要使用 refs。</p><h2 id="使用场景"><a aria-hidden="true" href="#使用场景"><span class="icon icon-link"></span></a>使用场景</h2><ul><li><strong>管理焦点（如文本选择）或处理表单数据</strong>：<code>refs</code> 将管理文本框当前焦点选中，或文本框其它属性。</li></ul><p>在大多数情况下，我们推荐使用受控组件来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理，每个状态更新都编写数据处理函数。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。要编写一个非受控组件，就需要使用 Refs 来从 DOM 节点中获取表单数据。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="class Form extends React.Component {
  constructor(props) {
    super(props);
    this.input = React.createRef();
  }

  handleSubmit = e =&gt; {
    console.log(&#x27;A name was submitted: &#x27; + this.input.current.value);
    e.preventDefault();
  };

  render() {
    return (
      &lt;form onSbumit={this.handleSubmit}&gt;
        &lt;label&gt;
          Name:
          &lt;input type=&quot;text&quot; ref={this.input} /&gt;
        &lt;/label&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
      &lt;/form&gt;
    );
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Form</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">input </span><span class="token operator">=</span><span class="token plain"> React</span><span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">handleSubmit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;A name was submitted: &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">input</span><span class="token punctuation">.</span><span class="token plain">current</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    e</span><span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">form</span><span class="token tag"> </span><span class="token tag attr-name">onSbumit</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript keyword">this</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">handleSubmit</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">label</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          Name</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token tag punctuation">&lt;</span><span class="token tag">input</span><span class="token tag"> </span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">text</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">ref</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript keyword">this</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">input</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">label</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">input</span><span class="token tag"> </span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">submit</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">value</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">Submit</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">form</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>因为非受控组件将真实数据储存在 DOM 节点中，所以再使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。非欧泽，你应该使用受控组件。</p><ul><li><p><strong>媒体播放</strong>：基于 Reac 的音乐或视频播放器可以利用 Refs 来管理其当前状态（播放/咱 ing）。或管理播放进度等。这些更新不需要进行状态管理。</p></li><li><p><strong>触发强制动画</strong>：如果要在元素上触发过强制动画时，可以使用 Refs 来执行此操作</p></li><li><p><strong>集成第三方 DOM 库</strong></p></li></ul><h2 id="实用价值"><a aria-hidden="true" href="#实用价值"><span class="icon icon-link"></span></a>实用价值</h2><p>推出 <a href="/react-guidebook//api-reference/react/create-ref">createRef</a> 与 <a href="/react-guidebook//api-reference/react/forward-ref">forwardRef</a>, 这是解决 <code>refs</code> 对象的原罪。React 会产生元素节点，但如果获得元素节点的引用是一个难题，于是推出了 <code>string ref</code> 与 <code>function ref</code>。<code>string ref</code> 有重大缺点，一个 <code>div</code> 需要知道是哪个组件 <code>render</code> 了自己，于是内部就有一个叫 <code>currentOwner</code> 的全局对象，每当组件实例化后，就把实例放到这上面，当下面的 <code>div</code>, <code>span</code> 在执行 <code>React.createElement(div/span, props, ...children)</code> 时，<code>currentOwner</code> 会神不知鬼不觉到混进内部，作为 ReactElement 的第 6 个参数<code>owner</code>。React.createElement 只是 <code>ReactElement</code> 的外壳，一个加工厂，ReactElement 的返回值才是我们熟悉的虚拟 DOM 。但 <code>currentOwner.current</code> 会改来改去，并且针对一些恶心情况做了许多补丁。随着 React 以后会考虑 <code>WebWorker</code> 方式进行更新，这全局的东西肯定是障碍。于是有了 <code>createRef</code>，返回一个 <code>object ref</code>，直接能拿到引用，它能早于组件诞生，方便用户操作。<code>forwardRef</code> 是用来指定 <code>object ref</code> 的活动范围。当然这东西与 HOC 也有关，这个有机会也再分享详述。总之，<code>ref</code> 与 <code>context</code> 一样，从组件中解耦出来。</p><h2 id="注意事项"><a aria-hidden="true" href="#注意事项"><span class="icon icon-link"></span></a>注意事项</h2><p>Refs 用于访问在渲染周期函数中创建的 DOM 节点或 React 元素。</p><p>⚠️ <strong>注意事项</strong>：避免对任何可以声明式解决的问题使用 Refs！</p><ul><li>当两个虚拟 DOM 的 <code>ref</code> 不同时，就会触发 <code>change ref</code>，这会在 <code>did.xx</code> 之前</li><li><code>set ref</code> 也在 <code>did.xx</code> 之后，当一个组件被移除，他的虚拟 DOM 恰好有 <code>ref</code></li><li>那么它在 <code>willUnmount</code> 之前 <code>getDerivedStateFromProps</code> 与 <code>componentDidCatch</code> 钩子不齐同，漏了 三大 <code>willXXX</code> 钩子与 <code>getXXX</code> 一直共存着的</li></ul><p>为防止内存泄漏，当写在一个组件的时候，组件里所有的 <code>ref</code> 就会变为 <code>null</code>。</p><p>值得注意的是，<code>React.findDOMNode</code> 和 <code>refs</code> 都无法用于无状态组件中。因为，无状态组件挂载时只是方法调用，并没有创建实例。</p><p>对于 React 组件来讲，<code>refs</code> 会指向一个组件类实例，所以可以调用该类定义的任何方法。如果需要访问该组件的真实 DOM，可以用 <code>ReactDOM.findDOMNode</code> 来找到 DOM 节点，但并不推荐这样做，因为这大部分情况下都打破了封装性，而且通常都能用更清晰的方法在 React 中构建代码。</p><h2 id="原理机制"><a aria-hidden="true" href="#原理机制"><span class="icon icon-link"></span></a>原理机制</h2><p>React 将会在组件挂载时将 DOM 元素分配给 <code>current</code> 属性，并且在组件被卸载时，将 <code>current</code> 属性重置为 <code>null</code>。<code>ref</code> 将会在 <code>componentDidMount</code> 和 <code>componentDidUpdate</code> 生命中器钩子前被更新。</p><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://juejin.im/post/5b59287af265da0f601317e3" target="_blank" rel="noopener noreferrer">📝 React ref 的前世今生<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://zhuanlan.zhihu.com/p/34604934" target="_blank" rel="noopener noreferrer">📝 React16 新特征总览<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/React-GuideBook/edit/master/docs/foundation/advanced-guides/refs.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/1/2020, 6:20:53 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/react-guidebook/umi.js"></script>
    <script src="/react-guidebook/docs__foundation__advanced-guides__refs.md.js"></script>
  </body>
</html>
