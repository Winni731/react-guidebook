<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/react-guidebook/umi.css" />
    <script>
      window.routerBase = "/react-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>组件化</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//">React Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a aria-current="page" class="active" href="/react-guidebook//foundation">基础</a><a href="/react-guidebook//architect">架构</a><a href="/react-guidebook//ecosystem">生态</a><a href="/react-guidebook//api-reference">API</a><a href="/react-guidebook//hooks">Hooks</a><a href="/react-guidebook//extensions">Extensions</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//"></a><h1>React Guidebook</h1><p>React 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/react-guidebook//foundation">基础</a></li><li><a href="/react-guidebook//architect">架构</a></li><li><a href="/react-guidebook//ecosystem">生态</a></li><li><a href="/react-guidebook//api-reference">API</a></li><li><a href="/react-guidebook//hooks">Hooks</a></li><li><a href="/react-guidebook//extensions">Extensions</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/react-guidebook//foundation/main-concepts">基础概念</a><ul><li><a href="/react-guidebook//foundation/main-concepts/overview"><span>特性</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/jsx"><span>JSX</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/state"><span>State</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/props"><span>Props</span></a></li><li><a aria-current="page" class="active" href="/react-guidebook//foundation/main-concepts/component"><span>组件化</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/lifecycle"><span>生命周期</span></a></li><li><a href="/react-guidebook//foundation/main-concepts/react-dom"><span>组件挂载器</span></a></li></ul></li><li><a href="/react-guidebook//foundation/advanced-guides">进阶指引</a><ul><li><a href="/react-guidebook//foundation/advanced-guides/render"><span>render</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/set-state"><span>setState</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/handling-events"><span>事件机制</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/high-order-component"><span>高阶组件</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/render-props"><span>Render Props</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/refs"><span>Refs</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/context"><span>Context</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/portals"><span>Portals</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/profiler"><span>Profiler</span></a></li><li><a href="/react-guidebook//foundation/advanced-guides/error-boundaries"><span>错误边界</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="Web Component" data-depth="2" class=""><a href="/react-guidebook//foundation/main-concepts/component#web-component"><span>Web Component</span></a></li><li title="组件类型" data-depth="2" class=""><a href="/react-guidebook//foundation/main-concepts/component#组件类型"><span>组件类型</span></a></li><li title="无状态组件" data-depth="3" class=""><a href="/react-guidebook//foundation/main-concepts/component#无状态组件"><span>无状态组件</span></a></li><li title="有状态组件" data-depth="3" class=""><a href="/react-guidebook//foundation/main-concepts/component#有状态组件"><span>有状态组件</span></a></li><li title="容器组件" data-depth="3" class=""><a href="/react-guidebook//foundation/main-concepts/component#容器组件"><span>容器组件</span></a></li><li title="高阶组件" data-depth="3" class=""><a href="/react-guidebook//foundation/main-concepts/component#高阶组件"><span>高阶组件</span></a></li><li title="渲染回调组件" data-depth="3" class=""><a href="/react-guidebook//foundation/main-concepts/component#渲染回调组件"><span>渲染回调组件</span></a></li><li title="总结" data-depth="2" class=""><a href="/react-guidebook//foundation/main-concepts/component#总结"><span>总结</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="组件化"><a aria-hidden="true" href="#组件化"><span class="icon icon-link"></span></a>组件化</h1><p>React 组件的封装思路就是面向对象思想。</p><p>规范标准组件准则：</p><ul><li><strong>基本的封装性</strong>：尽管说 JavaScript 没有真正面向对象的方法，但我们还是可以通过实例化的方法来制造对象。</li><li><strong>简单的生命周期呈现</strong>：最明显的两个方法 <code>constructor</code> 和 <code>destroy</code>，代表了组件的挂载和卸载过程。但除此之外，其他过程（如更新时的生命周期）并没有体现。</li><li><strong>明确的数据流动</strong>：这里的数据指的是调用组件的参数。一旦确定参数的值，就会解析传进来的参数，根据参数的不同作出不同的响应，从而得到渲染结果。</li></ul><h2 id="web-component"><a aria-hidden="true" href="#web-component"><span class="icon icon-link"></span></a>Web Component</h2><p>四个组成部分：</p><ul><li>HTML Templates 定义模版</li><li>Custom Elements 定义组件展示形式</li><li>Shadow DOM 定义组件的作用域范围、可以囊括样式</li><li>HTML Imports 提出新的引入方式</li></ul><h2 id="组件类型"><a aria-hidden="true" href="#组件类型"><span class="icon icon-link"></span></a>组件类型</h2><p>React 组件基本由三个部分组成：属性（Props）、状态（State）和生命周期钩子函数。</p><p><strong>React 组件类型：</strong></p><ul><li>无状态组件</li><li>有状态组件</li><li>容器组件</li><li>高阶组件</li><li>渲染回调组件</li></ul><h3 id="无状态组件"><a aria-hidden="true" href="#无状态组件"><span class="icon icon-link"></span></a>无状态组件</h3><p>无状态组件（Stateless Component）是最基础的组件形式，由于没有状态的影响所以就是纯静态展示的作用。一般来说，各种 UI 库里也是最开始会开发的组件类别。如按钮、标签、输入框等。它的基本组成结构就是属性（props）加上一个渲染函数（render）。由于不涉及到状态的更新，所以这种组件的复用性也最强。</p><p>这类组件有以下几个特点：</p><ul><li>只负责接收 <code>props</code>，渲染 DOM</li><li>没有 <code>state</code></li><li>不能访问生命周期方法</li><li>不需要声明类：可以避免 <code>extends</code> 或 <code>constructor</code> 之类的代码，语法上更加简洁。</li><li>不会被实例化：因此不能直接传 <code>ref</code>（可以使用 <code>React.forwardRef</code> 包装后再传 <code>ref</code>）。</li><li>不需要显示声明 <code>this</code> 关键字：在 ES6 的类声明中往往需要将函数的 <code>this</code> 关键字绑定到当前作用域，而因为函数式声明的特性，我们不需要再强制绑定。</li><li>更好的性能表现：因为函数式组件中并不需要进行生命周期的管理与状态管理，因此React并不需要进行某些特定的检查或者内存分配，从而保证了更好地性能表现。</li></ul><p>无状态组件的代码更加简单清晰且易于快速实现，它们适用于非常小的 UI 界面，即这些组件的重新渲染的成本很小。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const PureComponent = props =&gt; &lt;div&gt;Hello world！&lt;/div&gt;;
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">PureComponent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">props</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain">Hello world！</span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>无状态组件的写法十分简单，比起使用传统的组件定义方式，我通常就直接使用 ES6 语法中提供的箭头函数来声明这种组件形式。当然，如果碰到稍微复杂点的，可能还会带有生命周期的钩子函数。这时候就需要用到 <code>Class Component</code> 的写法了。</p><h3 id="有状态组件"><a aria-hidden="true" href="#有状态组件"><span class="icon icon-link"></span></a>有状态组件</h3><p>在无状态组件的基础上，如果组件内部包含状态（state）且状态随着事件或者外部的消息而发生改变的时候，这就构成了有状态组件（Stateful Component）。有状态组件通常会带有生命周期（Lifecycle），用以在不同的时刻触发状态的更新。这种组件也是通常在写业务逻辑中最经常使用到的，根据不同的业务场景组件的状态数量以及生命周期机制也不尽相同。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="class StatefulComponent extends Component {

    constructor(props) {
        super(props);
        this.state = {
            //定义状态
        }
    }

    componentWillMount() {
        //do something
    }

    componentDidMount() {
        //do something
    }

    // 其他生命周期

    render() {
        return (
            //render
        );
    }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">StatefulComponent</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">//定义状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">//do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">//do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 其他生命周期</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">//render</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="容器组件"><a aria-hidden="true" href="#容器组件"><span class="icon icon-link"></span></a>容器组件</h3><p>在具体的项目实践中，我们通常的前端数据都是通过 Ajax 请求获取的，而且获取的后端数据也需要进一步的做处理。为了使组件的职责更加单一，引入了容器组件（Container Component）的概念。我们将数据获取以及处理的逻辑放在容器组件中，使得组件的耦合性进一步地降低。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="class UserListContainer extends React.Component {
  getInitialState() {
    return {
      users: [],
    };
  }

  componentDidMount() {
    var _this = this;
    axios.get(&#x27;/path/to/user-api&#x27;).then(function(response) {
      _this.setState({ users: response.data });
    });
  }

  render() {
    return &lt;UserList users={this.state.users} /&gt;;
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">UserListContainer</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">React</span><span class="token class-name punctuation">.</span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      users</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">var</span><span class="token plain"> _this </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    axios</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/path/to/user-api&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      _this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> users</span><span class="token punctuation">:</span><span class="token plain"> response</span><span class="token punctuation">.</span><span class="token plain">data </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">UserList</span><span class="token tag"> </span><span class="token tag attr-name">users</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript keyword">this</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">state</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">users</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如上面这个容器组件，就是负责获取用户数据，然后以 <code>props</code> 的形式传递给 <code>UserList</code> 组件来渲染。容器组件也不会在页面中渲染出具体的 DOM 节点，因此，它通常就充当数据源的角色。目前很多常用的框架，也都采用这种组件形式。如：React Redux 的 <code>connect()</code>，Relay 的 <code>createContainer()</code>，Flux Utils 的 <code>Container.create()</code> 等。</p><h3 id="高阶组件"><a aria-hidden="true" href="#高阶组件"><span class="icon icon-link"></span></a>高阶组件</h3><p>其实对于一般的中小项目来说，你只需要用到以上的这三种组件方式就可以很好地构造出所需的应用了。但是当面对复杂的需求的时候，我们往往可以利用高阶组件（Higher-Order Component）编写出可重用性更强的组件。那么什么是高阶组件呢？其实它和高阶函数的概念类似，就是一个会返回组件的组件。或者更确切地说，它其实是一个会返回组件的函数。就像这样：</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const HigherOrderComponent = WrappedComponent =&gt; {
  return class WrapperComponent extends Component {
    render() {
      //do something with WrappedComponent
    }
  };
};
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">HigherOrderComponent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">WrapperComponent</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">//do something with WrappedComponent</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>作为一个高阶组件，可以在原有组件的基础上，对其增加新的功能和行为。我们一般希望编写的组件尽量纯净或者说其中的业务逻辑尽量单一。但是如果各种组件间又需要增加新功能，如打印日志，获取数据和校验数据等和展示无关的逻辑的时候，这些公共的代码就会被重复写很多遍。因此，我们可以抽象出一个高阶组件，用以给基础的组件增加这些功能，类似于插件的效果。</p><p>一个比较常见的例子是表单的校验。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="//检验规则，表格组件
const FormValidator = (WrappedComponent, validator, trigger) =&gt; {

   getTrigger(trigger, validator) {
      var originTrigger = this.props[trigger];
      return function(event) {
          //触发验证机制,更新状态
          // do something ...
          originTrigger(event);
      }
  }

  var newProps = {
    ...this.props,
    [trigger]:   this.getTrigger(trigger, validator) //触发时机,重新绑定原有触发机制
  };

  return &lt;WrappedComponent  {...newProps} /&gt;
}
" data-status="copy"></button><div class="token-line"><span class="token comment">//检验规则，表格组件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">FormValidator</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token parameter punctuation">,</span><span class="token parameter"> validator</span><span class="token parameter punctuation">,</span><span class="token parameter"> trigger</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token parameter">trigger</span><span class="token parameter punctuation">,</span><span class="token parameter"> validator</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">var</span><span class="token plain"> originTrigger </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">props</span><span class="token punctuation">[</span><span class="token plain">trigger</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">//触发验证机制,更新状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// do something ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token function">originTrigger</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">var</span><span class="token plain"> newProps </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token operator">...</span><span class="token plain">this</span><span class="token punctuation">.</span><span class="token plain">props</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">[</span><span class="token plain">trigger</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token plain">   </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token plain">trigger</span><span class="token punctuation">,</span><span class="token plain"> validator</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">//触发时机,重新绑定原有触发机制</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">WrappedComponent</span><span class="token tag">  </span><span class="token tag spread punctuation">{</span><span class="token tag spread punctuation">...</span><span class="token tag spread attr-value">newProps</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>值得提一句，同样是给组件增加新功能的方法，相比于使用 mixins 这种方式高阶组件则更加简洁和职责更加单一。你如果使用过多个 mixins 的时候，状态污染就十分容易发生，以及你很难从组件的定义上看出隐含在 mixins 中的逻辑。而高阶组件的处理方式则更加容易维护。</p><p>另一方面，ES7 中新的语法 <code>Decorator</code> 也可以用来实现和上面写法一样的效果。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="function LogDecorator(msg) {
  return WrappedComponent =&gt; {
    return class LogHoc extends Component {
      render() {
        // do something with this component
        console.log(msg);
        &lt;WrappedComponent {...this.props} /&gt;;
      }
    };
  };
}

@LogDecorator(&#x27;hello world&#x27;)
class HelloComponent extends Component {
  render() {
    //...
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">LogDecorator</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token parameter">WrappedComponent</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">LogHoc</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// do something with this component</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">WrappedComponent</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread punctuation">...</span><span class="token tag spread attr-value">this</span><span class="token tag spread punctuation">.</span><span class="token tag spread attr-value">props</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">@</span><span class="token function">LogDecorator</span><span class="token punctuation">(</span><span class="token string">&#x27;hello world&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">HelloComponent</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="渲染回调组件"><a aria-hidden="true" href="#渲染回调组件"><span class="icon icon-link"></span></a>渲染回调组件</h3><p>还有一种组件模式是在组件中使用渲染回调的方式，将组件中的渲染逻辑委托给其子组件。</p><div class="__dumi-default-code-block"><pre class="prism-code language-jsx"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import { Component } from &#x27;react&#x27;;

class RenderCallbackCmp extends Component {
  constructor(props) {
    super(props);
    this.state = {
      msg: &#x27;hello&#x27;,
    };
  }

  render() {
    return this.props.children(this.state.msg);
  }
}

const ParentComponent = () =&gt; (
  &lt;RenderCallbackCmp&gt;
    {msg =&gt; (
      //use the msg
      &lt;div&gt;{msg}&lt;/div&gt;
    )}
  &lt;/RenderCallbackCmp&gt;
);
" data-status="copy"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> Component </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">RenderCallbackCmp</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">super</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">state </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      msg</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">props</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">msg</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">ParentComponent</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">RenderCallbackCmp</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token parameter">msg</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">//use the msg</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">msg</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">RenderCallbackCmp</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>父组件获取了内部的渲染逻辑，因此在需要控制渲染机制时可以使用这种组件形式。</p><h2 id="总结"><a aria-hidden="true" href="#总结"><span class="icon icon-link"></span></a>总结</h2><p>以上这些组件编写模式基本上可以覆盖目前工作中所需要的模式。在写一些复杂的框架组件的时候，仔细设计和研究组件间的解耦和组合方式，能够使后续的项目可维护性大大增强。</p><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://juejin.im/post/596d65d66fb9a06bae1e19e2" target="_blank" rel="noopener noreferrer">📝 React 中的五种组件形式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/React-GuideBook/edit/master/docs/foundation/main-concepts/component.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">8/31/2020, 7:09:52 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/react-guidebook/umi.js"></script>
    <script src="/react-guidebook/docs__foundation__main-concepts__component.md.js"></script>
  </body>
</html>
