<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/react-guidebook/umi.css" />
    <script>
      window.routerBase = "/react-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>React Saga</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//">React Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/react-guidebook//foundation">基础</a><a href="/react-guidebook//architect">架构</a><a aria-current="page" class="active" href="/react-guidebook//ecosystem">生态</a><a href="/react-guidebook//api-reference">API</a><a href="/react-guidebook//hooks">Hooks</a><a href="/react-guidebook//extensions">扩展</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/react-guidebook-favicon.png&#x27;)" href="/react-guidebook//"></a><h1>React Guidebook</h1><p>React 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/react-guidebook//foundation">基础</a></li><li><a href="/react-guidebook//architect">架构</a></li><li><a aria-current="page" class="active" href="/react-guidebook//ecosystem">生态</a></li><li><a href="/react-guidebook//api-reference">API</a></li><li><a href="/react-guidebook//hooks">Hooks</a></li><li><a href="/react-guidebook//extensions">扩展</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/react-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/react-guidebook//ecosystem/routing">路由</a><ul><li><a href="/react-guidebook//ecosystem/routing/spa-routing"><span>路由机制</span></a></li><li><a href="/react-guidebook//ecosystem/routing/react-router"><span>React Router</span></a></li></ul></li><li><a href="/react-guidebook//ecosystem/type">类型检查</a><ul><li><a href="/react-guidebook//ecosystem/type/prop-types"><span>PropTypes</span></a></li><li><a href="/react-guidebook//ecosystem/type/flow"><span>Flow</span></a></li><li><a href="/react-guidebook//ecosystem/type/typescript"><span>TypeScript</span></a></li></ul></li><li><a aria-current="page" class="active" href="/react-guidebook//ecosystem/data-flow">数据流</a><ul><li><a href="/react-guidebook//ecosystem/data-flow/flux"><span>Flux</span></a></li><li><a href="/react-guidebook//ecosystem/data-flow/redux"><span>Redux</span></a></li><li><a href="/react-guidebook//ecosystem/data-flow/react-redux"><span>React Redux</span></a></li><li><a aria-current="page" class="active" href="/react-guidebook//ecosystem/data-flow/redux-saga"><span>React Saga</span></a></li><li><a href="/react-guidebook//ecosystem/data-flow/redux-thunk"><span>Redux Thunk</span></a></li><li><a href="/react-guidebook//ecosystem/data-flow/mobx"><span>Mobx</span></a></li><li><a href="/react-guidebook//ecosystem/data-flow/immutable"><span>Immutable</span></a></li><li><a href="/react-guidebook//ecosystem/data-flow/dva"><span>Dva</span></a></li></ul></li><li><a href="/react-guidebook//ecosystem/ssr">服务端渲染</a><ul><li><a href="/react-guidebook//ecosystem/ssr/ssr"><span>SSR</span></a></li><li><a href="/react-guidebook//ecosystem/ssr/next"><span>Next</span></a></li></ul></li><li><a href="/react-guidebook//ecosystem/test">测试</a><ul><li><a href="/react-guidebook//ecosystem/test/test-utils"><span>Test Utilities</span></a></li><li><a href="/react-guidebook//ecosystem/test/test-render"><span>Test Render</span></a></li><li><a href="/react-guidebook//ecosystem/test/jest"><span>Jest</span></a></li><li><a href="/react-guidebook//ecosystem/test/enzyme"><span>Enzyme</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="基本用法" data-depth="2" class=""><a href="/react-guidebook//ecosystem/data-flow/redux-saga#基本用法"><span>基本用法</span></a></li><li title="Effect" data-depth="2" class=""><a href="/react-guidebook//ecosystem/data-flow/redux-saga#effect"><span>Effect</span></a></li><li title="API" data-depth="2" class=""><a href="/react-guidebook//ecosystem/data-flow/redux-saga#api"><span>API</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="redux-saga"><a aria-hidden="true" href="#redux-saga"><span class="icon icon-link"></span></a>Redux Saga</h1><p><code>redux-saga</code> 是一个用于管理 Redux 应用异步操作（Side Effects 异步操作）的中间件。<code>redux-saga</code> 通过创建 Sagas 将所有的异步操作逻辑收集在一个地方集中处理，可以用来代替 <code>redux-thunk</code> 中间件。</p><p>这意味着应用的逻辑会存在两个地方：</p><ul><li>Reducers 负责处理 <code>action</code> 的 <code>state</code> 更新</li><li>Sagas 负责协调那些复杂或异步的操作</li></ul><p>Sagas 是通过 Generator 函数来创建的。如果你还不熟悉 Generator，可以在这里找到 一些有用的链接。</p><p>Sagas 不同于 Thunks，Thunks 是在 <code>action</code> 被创建时调用，而 Sagas 只会在应用启动时调用（但初始启动的 Sagas 可能会动态调用其他 Sagas）。 Sagas 可以被看作是在后台运行的进程。Sagas 监听发起的 <code>action</code>，然后决定基于这个 <code>action</code> 来做什么：是发起一个异步调用（比如一个 AJAX 请求），还是发起其他的 <code>action</code> 到 Store，甚至是调用其他的 Sagas。</p><p>在 <code>redux-saga</code> 的世界里，所有的任务都通用 <code>yield</code> Effects 来完成（译注：Effect 可以看作是 <code>redux-saga</code> 的任务单元）。Effects 都是简单的 Javascript 对象，包含了要被 Saga <code>middleware</code> 执行的信息（打个比方，你可以看到 Redux <code>action</code> 其实是一个个包含执行信息的对象）。<code>redux-saga</code> 为各项任务提供了各种 Effect 创建器，比如调用一个异步函数，发起一个 <code>action</code> 到 Store，启动一个后台任务或者等待一个满足某些条件的未来的 <code>action</code>。</p><p>因为使用了 Generator，<code>redux-saga</code> 让你可以用 <strong>同步的方式写异步代码</strong>。就像你可以使用 <code>async/await</code> 函数所能做的一样。但 Generator 可以让你做一些 <code>async</code> 函数做不到的事情。</p><p>事实上 Sagas <code>yield</code> 普通对象的方式让你能容易地测试 Generator 里所有的业务逻辑，可以通过简单地迭代 <code>yield</code> 过的对象进行简单的单元测试。</p><p>此外，<code>redux-saga </code>启动的任务可以在任何时候通过手动取消，也可以把任务和其他的 Effects 放到 <code>race</code> 方法里以自动取消。</p><h2 id="基本用法"><a aria-hidden="true" href="#基本用法"><span class="icon icon-link"></span></a>基本用法</h2><ol><li><p>使用 <code>createSagaMiddleware</code> 方法创建 Saga 的 Middleware，然后在创建的 Redux 的 Store 时，使用 <code>applyMiddleware</code> 函数将创建的 Saga Middleware 实例绑定到 Store 上，最后可以调用 Saga Middleware 的 <code>run</code> 函数来执行某个或者某些 Middleware</p></li><li><p>在 Saga 的 Middleware 中，可以使用 <code>takeEvery</code> 或者 <code>takeLatest</code> 等 API 来监听某个 <code>action</code>，当某个 <code>action</code> 触发后，<code>saga</code> 可以使用 <code>call</code> 发起异步操作，操作完成后使用 <code>put</code> 函数触发 <code>action</code>，同步更新 <code>state</code>，从而完成整个 State 的更新</p></li></ol><p><strong>sagas.js</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import { call, put, takeEvery, takeLatest } from &#x27;redux-saga/effects&#x27;
import Api from &#x27;./api&#x27;

// Worker Saga：将 USER_FETCH_REQUESTED action 被 dispatch 时调用
function * fetchUser(action) {
  try {
    const user = yield call(Api.fetchUser, action.payload.userId)
    yield put({ type: &#x27;USER_FETCH_SUCCEEDED&#x27;, user: user })
  } catch (err) {
    yield put({ type: &#x27;USER_FETCH_FAILED, message: e.message&#x27; })
  }
}

// 在每个 USER_FETCH_REQUESTED action 被 dispatch 时调用 fetchUser
// 允许并发（即同时处理多个相同的 action）
function * saga () {
  yield takeEvery(&#x27;USER_FETCH_REQUESTED&#x27;, fetchUser);
}

// 也可以使用 takeLatest
// 不允许并发，disaptch 一个 USER_FETCH_REQUESTED action 时
// 如果在这之前已经有一个 USER_FETCH_REQUESTED action 在处理中
// 那么处理中的 action 会被取消，只会执行当前的
function * saga () {
  yield takeLatest(&#x27;USER_FETCH_REQUESTED&#x27;, fetchUser);
}

export default saga;
" data-status="copy"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> call</span><span class="token punctuation">,</span><span class="token plain"> put</span><span class="token punctuation">,</span><span class="token plain"> takeEvery</span><span class="token punctuation">,</span><span class="token plain"> takeLatest </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;redux-saga/effects&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">Api</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./api&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// Worker Saga：将 USER_FETCH_REQUESTED action 被 dispatch 时调用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> user </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">call</span><span class="token punctuation">(</span><span class="token maybe-class-name">Api</span><span class="token punctuation">.</span><span class="token property-access">fetchUser</span><span class="token punctuation">,</span><span class="token plain"> action</span><span class="token punctuation">.</span><span class="token property-access">payload</span><span class="token punctuation">.</span><span class="token property-access">userId</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;USER_FETCH_SUCCEEDED&#x27;</span><span class="token punctuation">,</span><span class="token plain"> user</span><span class="token punctuation">:</span><span class="token plain"> user </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;USER_FETCH_FAILED, message: e.message&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 在每个 USER_FETCH_REQUESTED action 被 dispatch 时调用 fetchUser</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 允许并发（即同时处理多个相同的 action）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function">saga</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&#x27;USER_FETCH_REQUESTED&#x27;</span><span class="token punctuation">,</span><span class="token plain"> fetchUser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 也可以使用 takeLatest</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 不允许并发，disaptch 一个 USER_FETCH_REQUESTED action 时</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 如果在这之前已经有一个 USER_FETCH_REQUESTED action 在处理中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 那么处理中的 action 会被取消，只会执行当前的</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token function">saga</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">takeLatest</span><span class="token punctuation">(</span><span class="token string">&#x27;USER_FETCH_REQUESTED&#x27;</span><span class="token punctuation">,</span><span class="token plain"> fetchUser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> saga</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>main.js</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="import { createStore, applyMiddleware } from &#x27;redux&#x27;
import createSagaMiddleware from &#x27;redux-saga&#x27;

import reducer from &#x27;./reducers&#x27;
import saga from &#x27;./sagas&#x27;

// 创建 Redux Saga 中间件
const sagaMiddleware = createSagaMiddleware()

// 挂载在 Redux Store 上
const store = createStore(
  reducer,
  applyMiddleware(sagaMiddleware)
)

// 执行 Saga
sagaMiddleware.run(saga)

// 渲染应用
" data-status="copy"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> createStore</span><span class="token punctuation">,</span><span class="token plain"> applyMiddleware </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;redux&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> createSagaMiddleware </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;redux-saga&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> reducer </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./reducers&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> saga </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./sagas&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 创建 Redux Saga 中间件</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> sagaMiddleware </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 挂载在 Redux Store 上</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  reducer</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token plain">sagaMiddleware</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行 Saga</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">sagaMiddleware</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token plain">saga</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 渲染应用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="effect"><a aria-hidden="true" href="#effect"><span class="icon icon-link"></span></a>Effect</h2><p>Sagas 都是 Generator 函数实现，可以用 <code>yield</code> 对 JavaScript 对象来表达 Saga 的逻辑，这些对象就是 Effect。</p><ol><li>Sagas 都是用 Generator 函数实现的</li><li>在 Generator 函数中，<code>yield</code> 右边的任何表达式都会被求值，结果会被 <code>yield</code> 给调用者</li><li>用 <code>yield</code> 对 Effect（简单对象），进行解释执行</li><li>Effect 是一个简单的对象，这个对象包含了一些给 <code>middleware</code> 解释执行的信息。 你可以把 Effect 看作是发送给 <code>middleware</code> 的指令以执行某些操作（调用某些异步函数，发起一个 <code>action</code> 到 <code>store</code> 等等）</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 官方例子
import { takeEvery } from &#x27;redux-saga/effects&#x27;
import Api from &#x27;./path/to/api&#x27;

// 监听如果有一个调用 PRODUCTS_REQUESTED 的 action 的话,就会匹配到第二个参数所代表的 effect
function* watchFetchProducts() {
  yield takeEvery(&#x27;PRODUCTS_REQUESTED&#x27;, fetchProducts)
}

// 执行，获取数据
// 使用 Generator 调用了 Api.fetch，在 Generator 函数中，yield 右面的任何表达式都会被求值，结果会被 yield 给调用者
function* fetchProducts() {
  const products = yield Api.fetch(&#x27;/products&#x27;)
  console.log(products)
}

// 第二种方式
import { call } from &#x27;redux-saga/effects&#x27;
// call(fn, ...args) 这个函数。与前面的例子不同的是，现在我们不立即执行异步调用
// 相反，call 创建了一条描述结果的信息就像在 Redux 里你使用 action 创建器，创建一个将被 Store 执行的、描述 action 的纯文本对象
// call 创建一个纯文本对象描述函数调用。redux-saga middleware 确保执行函数调用并在响应被 resolve 时恢复 generator
function* fetchProducts() {
  const products = yield call(Api.fetch, &#x27;/products&#x27;)
  // do something
}
" data-status="copy"></button><div class="token-line"><span class="token comment">// 官方例子</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> takeEvery </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;redux-saga/effects&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">Api</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./path/to/api&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 监听如果有一个调用 PRODUCTS_REQUESTED 的 action 的话,就会匹配到第二个参数所代表的 effect</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token operator">*</span><span class="token plain"> </span><span class="token function">watchFetchProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&#x27;PRODUCTS_REQUESTED&#x27;</span><span class="token punctuation">,</span><span class="token plain"> fetchProducts</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行，获取数据</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 使用 Generator 调用了 Api.fetch，在 Generator 函数中，yield 右面的任何表达式都会被求值，结果会被 yield 给调用者</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token operator">*</span><span class="token plain"> </span><span class="token function">fetchProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> products </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token maybe-class-name">Api</span><span class="token punctuation">.</span><span class="token method function property-access">fetch</span><span class="token punctuation">(</span><span class="token string">&#x27;/products&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">products</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 第二种方式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> call </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;redux-saga/effects&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// call(fn, ...args) 这个函数。与前面的例子不同的是，现在我们不立即执行异步调用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 相反，call 创建了一条描述结果的信息就像在 Redux 里你使用 action 创建器，创建一个将被 Store 执行的、描述 action 的纯文本对象</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// call 创建一个纯文本对象描述函数调用。redux-saga middleware 确保执行函数调用并在响应被 resolve 时恢复 generator</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token operator">*</span><span class="token plain"> </span><span class="token function">fetchProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> products </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token function">call</span><span class="token punctuation">(</span><span class="token maybe-class-name">Api</span><span class="token punctuation">.</span><span class="token property-access">fetch</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;/products&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="api"><a aria-hidden="true" href="#api"><span class="icon icon-link"></span></a>API</h2><ul><li>Middleware API<ul><li><code>createSagaMiddleware(...sagas)</code>：创建 Redux 中间件，将 Sagas 与 Redux Store 简历连接</li><li><code>middleware.run(saga, ...args)</code>：动态执行 Saga，用于 <code>applyMiddleware</code> 阶段之后执行 Sagas</li></ul></li><li>Saga Helpers 辅助函数（在 Effect 创建器的基础之上构建）<ul><li><code>takeEvery(pattern, saga, ...args)</code>：在发起 <code>action</code> 与 <code>pattern</code> 匹配时派生指定的 <code>saga</code></li><li><code>takeLatest(pattern, saga, ..args)</code>：在发起 <code>action</code> 与 <code>pattern</code> 匹配时派生指定的 <code>saga</code>，并且自动取消之前启动的所有 <code>saga</code> 任务（如果在执行中）</li></ul></li><li>Effect creators 创建器<ul><li><code>take(pattern)</code>：创建一条 Effect 描述信息，指示 middleware 等待 Store 上指定的 action。Generator 会暂停，知道一个与 <code>pattern</code> 匹配的 <code>action</code> 被发起</li><li><code>put(action)</code>：指示 middleware 发起一个 <code>action</code> 到 Store</li><li><code>call(fn, ...args)</code>：指定 middleware 调用 <code>fn</code> 函数并以 <code>args</code> 为参数</li><li><code>call([context, fn], ...args)</code>：同上，但是支持 <code>fn</code> 指定 <code>this</code> 上下文</li><li><code>apply(context, fn, args)</code>：同上，参数为数组</li><li><code>cps(fn, ...args)</code>：指示 middleware 以 Node 风格掉哟功能 <code>fn</code> 函数</li><li><code>cps([context, fn], ...args)</code>：支持为 <code>fn</code> 指定 <code>this</code> 上下文（调用对象方法）</li><li><code>fork(fn, ...args)</code>：指示 middleware 以 <strong>无阻塞调用</strong> 方式执行 <code>fn</code></li><li><code>fork([context, fn], ...args)</code>：同上，但是支持 <code>fn</code> 指定上下文</li><li><code>join(task)</code>：指示 middleware 等待之前的 <code>fork</code> 任务返回结果</li><li><code>cancel(task)</code>：指示 middlware 取消之前的 <code>fork</code> 任务</li><li><code>select(selector, ...args)</code>：指示 middleware 调用提供的选择器获取 Store state 上的数据</li></ul></li><li>Effect combinators<ul><li><code>race(effects)</code>：指示 middleware 在多个 Effect 之间执行一个 <code>race</code> 的操作</li><li><code>[...effects] (aka parallel effects)</code>：指示 middleware 并行执行多个 Effect，并等待所有 Effect 完成</li></ul></li><li>Interfaces<ul><li><code>Task</code><ul><li><code>task.isRunning()</code>：如果任务还未返回或跑出了一个错误则返回 <code>true</code></li><li><code>task.result()</code>：任务的返回值，如果任务正在执行中则返回 <code>undefined</code></li><li><code>task.error()</code>：任务抛出的错误，如果任务正在执行中则返回 <code>undefined</code></li><li><code>task.done</code>：Promise（以任务的返回值 <code>resolve</code>、以任务抛出的错误 <code>reject</code>）</li><li><code>task.cancel()</code>：取消任务（如果任务还在执行中）</li></ul></li></ul></li><li>External API<ul><li><code>runSaga(iterator, <!-- -->{<!-- -->subscribe, dispatch, getState<!-- -->}<!-- -->, [monitor])</code>：允许在 Redux middleware 环境外部启动 sagas。当你想将 Saga 连接至外部的输入和输出时，而不是 Store 的 action，会很有用。</li></ul></li></ul><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://chenyitian.gitbooks.io/redux-saga/content/" target="_blank" rel="noopener noreferrer">Redux-Saga 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzA4NjcyMDYzMg==&amp;mid=2451805550&amp;idx=1&amp;sn=84c84d73789b960f845515d701a6e0d2&amp;chksm=88135c79bf64d56fb27009192ec3d724645a1d375b9006b7c09bad0a2aa1a3446f823e90d928&amp;scene=0&amp;xtrack=1" target="_blank" rel="noopener noreferrer">redux-saga 化异步为同步<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/React-GuideBook/edit/master/docs/ecosystem/data-flow/redux-saga.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/1/2020, 6:20:53 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/react-guidebook/umi.js"></script>
    <script src="/react-guidebook/docs__ecosystem__data-flow__redux-saga.md.js"></script>
  </body>
</html>
