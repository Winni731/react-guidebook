<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Refs | React-Guidebook</title>
    <meta name="description" content="">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/react-guidebook/assets/css/0.styles.e28a9572.css" as="style"><link rel="preload" href="/react-guidebook/assets/js/app.260c1e95.js" as="script"><link rel="preload" href="/react-guidebook/assets/js/2.faf5b053.js" as="script"><link rel="preload" href="/react-guidebook/assets/js/44.c75d55fd.js" as="script"><link rel="prefetch" href="/react-guidebook/assets/js/10.12b8a1f6.js"><link rel="prefetch" href="/react-guidebook/assets/js/11.08027518.js"><link rel="prefetch" href="/react-guidebook/assets/js/12.96017118.js"><link rel="prefetch" href="/react-guidebook/assets/js/13.843c2301.js"><link rel="prefetch" href="/react-guidebook/assets/js/14.350d4ea6.js"><link rel="prefetch" href="/react-guidebook/assets/js/15.922c628d.js"><link rel="prefetch" href="/react-guidebook/assets/js/16.179de27c.js"><link rel="prefetch" href="/react-guidebook/assets/js/17.d6f21d06.js"><link rel="prefetch" href="/react-guidebook/assets/js/18.3b94c7d4.js"><link rel="prefetch" href="/react-guidebook/assets/js/19.9d272f30.js"><link rel="prefetch" href="/react-guidebook/assets/js/20.5719f794.js"><link rel="prefetch" href="/react-guidebook/assets/js/21.32a481df.js"><link rel="prefetch" href="/react-guidebook/assets/js/22.a8130aca.js"><link rel="prefetch" href="/react-guidebook/assets/js/23.04c27a3a.js"><link rel="prefetch" href="/react-guidebook/assets/js/24.bc3baace.js"><link rel="prefetch" href="/react-guidebook/assets/js/25.e2bf72b2.js"><link rel="prefetch" href="/react-guidebook/assets/js/26.e2f5f647.js"><link rel="prefetch" href="/react-guidebook/assets/js/27.12c8dd66.js"><link rel="prefetch" href="/react-guidebook/assets/js/28.786c50e6.js"><link rel="prefetch" href="/react-guidebook/assets/js/29.bdb196e1.js"><link rel="prefetch" href="/react-guidebook/assets/js/3.28696f6a.js"><link rel="prefetch" href="/react-guidebook/assets/js/30.cf0e07b4.js"><link rel="prefetch" href="/react-guidebook/assets/js/31.6dad3ae2.js"><link rel="prefetch" href="/react-guidebook/assets/js/32.bd3b8924.js"><link rel="prefetch" href="/react-guidebook/assets/js/33.c7028e61.js"><link rel="prefetch" href="/react-guidebook/assets/js/34.980dc58f.js"><link rel="prefetch" href="/react-guidebook/assets/js/35.b7595861.js"><link rel="prefetch" href="/react-guidebook/assets/js/36.5096dad5.js"><link rel="prefetch" href="/react-guidebook/assets/js/37.95547070.js"><link rel="prefetch" href="/react-guidebook/assets/js/38.158db71c.js"><link rel="prefetch" href="/react-guidebook/assets/js/39.533eee82.js"><link rel="prefetch" href="/react-guidebook/assets/js/4.63e5ba6d.js"><link rel="prefetch" href="/react-guidebook/assets/js/40.58cb3743.js"><link rel="prefetch" href="/react-guidebook/assets/js/41.d5b5333a.js"><link rel="prefetch" href="/react-guidebook/assets/js/42.8fd16888.js"><link rel="prefetch" href="/react-guidebook/assets/js/43.17e7ea62.js"><link rel="prefetch" href="/react-guidebook/assets/js/45.cfb8cfbd.js"><link rel="prefetch" href="/react-guidebook/assets/js/46.21fefad7.js"><link rel="prefetch" href="/react-guidebook/assets/js/47.65560a73.js"><link rel="prefetch" href="/react-guidebook/assets/js/48.b09b6aff.js"><link rel="prefetch" href="/react-guidebook/assets/js/49.17f999ca.js"><link rel="prefetch" href="/react-guidebook/assets/js/5.dd0f972b.js"><link rel="prefetch" href="/react-guidebook/assets/js/50.3c7b255a.js"><link rel="prefetch" href="/react-guidebook/assets/js/51.f1ffef2a.js"><link rel="prefetch" href="/react-guidebook/assets/js/52.8414d27e.js"><link rel="prefetch" href="/react-guidebook/assets/js/53.ee10be58.js"><link rel="prefetch" href="/react-guidebook/assets/js/54.790296ee.js"><link rel="prefetch" href="/react-guidebook/assets/js/55.b3491420.js"><link rel="prefetch" href="/react-guidebook/assets/js/56.ded674be.js"><link rel="prefetch" href="/react-guidebook/assets/js/57.f989e8b0.js"><link rel="prefetch" href="/react-guidebook/assets/js/58.2cc1c592.js"><link rel="prefetch" href="/react-guidebook/assets/js/6.38cc656d.js"><link rel="prefetch" href="/react-guidebook/assets/js/7.86641c97.js"><link rel="prefetch" href="/react-guidebook/assets/js/8.8391da58.js"><link rel="prefetch" href="/react-guidebook/assets/js/9.a3a45a50.js">
    <link rel="stylesheet" href="/react-guidebook/assets/css/0.styles.e28a9572.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/react-guidebook/" class="home-link router-link-active"><img src="/react-guidebook/favicon.png" alt="React-Guidebook" class="logo"> <span class="site-name can-hide">React-Guidebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/tsejx/React-Guidebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/tsejx/React-Guidebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基本概念</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/concept/react.html" class="sidebar-link">React 特性</a></li><li><a href="/react-guidebook/concept/jsx.html" class="sidebar-link">JSX 语法</a></li><li><a href="/react-guidebook/concept/props.html" class="sidebar-link">Props</a></li><li><a href="/react-guidebook/concept/state.html" class="sidebar-link">State</a></li><li><a href="/react-guidebook/concept/lifecycle.html" class="sidebar-link">生命周期</a></li><li><a href="/react-guidebook/concept/component.html" class="sidebar-link">组件化</a></li><li><a href="/react-guidebook/concept/react-dom.html" class="sidebar-link">ReactDOM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>核心架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/core/fiber.html" class="sidebar-link">Fiber</a></li><li><a href="/react-guidebook/core/virtual-dom.html" class="sidebar-link">Virtual DOM</a></li><li><a href="/react-guidebook/core/diffing-algorithm.html" class="sidebar-link">差异化算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>运行机制</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/mechanism/set-state.html" class="sidebar-link">setState</a></li><li><a href="/react-guidebook/mechanism/render.html" class="sidebar-link">渲染策略</a></li><li><a href="/react-guidebook/mechanism/refs.html" class="active sidebar-link">Refs</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/react-guidebook/mechanism/portals.html" class="sidebar-link">Portals</a></li><li><a href="/react-guidebook/mechanism/context.html" class="sidebar-link">Context</a></li><li><a href="/react-guidebook/mechanism/render-props.html" class="sidebar-link">Render Props</a></li><li><a href="/react-guidebook/mechanism/high-order-component.html" class="sidebar-link">高阶组件</a></li><li><a href="/react-guidebook/mechanism/handling-events.html" class="sidebar-link">事件处理</a></li><li><a href="/react-guidebook/mechanism/synthetic-event.html" class="sidebar-link">合成事件</a></li><li><a href="/react-guidebook/mechanism/hooks.html" class="sidebar-link">Hooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>功能扩展</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/feature/memo.html" class="sidebar-link">React.memo</a></li><li><a href="/react-guidebook/feature/pure-component.html" class="sidebar-link">React.PureComponent</a></li><li><a href="/react-guidebook/feature/fragment.html" class="sidebar-link">React.Fragment</a></li><li><a href="/react-guidebook/feature/create-ref.html" class="sidebar-link">React.createRef</a></li><li><a href="/react-guidebook/feature/forward-ref.html" class="sidebar-link">React.forwardRef</a></li><li><a href="/react-guidebook/feature/lazy.html" class="sidebar-link">React.lazy</a></li><li><a href="/react-guidebook/feature/suspense.html" class="sidebar-link">React.Suspense</a></li><li><a href="/react-guidebook/feature/clone-element.html" class="sidebar-link">React.cloneElement</a></li><li><a href="/react-guidebook/feature/is-valid-element.html" class="sidebar-link">React.isValidElement</a></li><li><a href="/react-guidebook/feature/children.html" class="sidebar-link">React.Children</a></li><li><a href="/react-guidebook/feature/force-update.html" class="sidebar-link">forceUpdate</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>生态</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>路由管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/ecosystem/routing/spa-routing.html" class="sidebar-link">单页面应用路由机制</a></li><li><a href="/react-guidebook/ecosystem/routing/react-router.html" class="sidebar-link">React Router</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>数据管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/ecosystem/redux/flux.html" class="sidebar-link">Flux</a></li><li><a href="/react-guidebook/ecosystem/redux/redux.html" class="sidebar-link">Redux</a></li><li><a href="/react-guidebook/ecosystem/redux/react-redux.html" class="sidebar-link">React Redux</a></li><li><a href="/react-guidebook/ecosystem/redux/redux-saga.html" class="sidebar-link">Redux Saga</a></li><li><a href="/react-guidebook/ecosystem/redux/redux-thunk.html" class="sidebar-link">Redux Thunk</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>类型检测</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-guidebook/ecosystem/type/prop-types.html" class="sidebar-link">PropTypes</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="refs"><a href="#refs" aria-hidden="true" class="header-anchor">#</a> Refs</h1> <blockquote><p>🚧 施工中，未完成</p></blockquote> <p>Refs 用于访问在渲染周期函数中创建的 DOM 节点或 React 元素。</p> <p>🎉 <strong>常用场景</strong>：管理焦点、文本选择、媒体回放；触发必要动画；整合第三方 DOM 库。</p> <p>⚠️ <strong>注意事项</strong>：避免对任何可以声明式解决的问题使用 Refs！</p> <p>change ref</p> <p>set ref</p> <p>delete ref</p> <ul><li>当两个虚拟 DOM 的 ref 不同时，就会触发 change ref，这会在 did.xx 之前</li> <li>set ref 也在 did.xx 之后，当一个组件被移除，他的虚拟 DOM 恰好有 ref</li> <li>那么它在 willUnmount 之前 getDerivedStateFromProps 与 componentDidCatch 钩子不齐同，漏了 三大 willXXX 钩子与 getXXX 一直共存着的</li></ul> <p>推出<strong>createRef</strong>与<strong>forwardRef</strong> (抄自 angular2), 这是解决 refs 对象的原罪。React 会产生元素节点，但如果获得元素节点的引用是一个难题，于是推出了<code>string ref</code>与<code>function ref</code>。string ref 有重大缺点，一个 div 需要知道是哪个组件 render 了自己，于是内部就有一个叫 currentOwner 的全局对象，每当组件实例化后，就把实例放到这上面，当下面的 div, span 在执行<code>React.createElement(div/span, props, ...children)</code>时， currentOwner 会神不知鬼不觉到混进内部，作为 ReactElement 的第 6 个参数_owner。React.createElement 只是 ReactElement 的外壳，一个加工厂，ReactElement 的返回值才是我们熟悉的虚拟 DOM 。但 currentOwner.current 会改来改去，并且针对一些恶心情况做了许多补丁。随着 React 以后会考虑 WebWorker 方式进行更新，这全局的东西肯定是障碍。于是有了 createRef，返回一个<code>object ref</code>，直接能拿到引用，它能早于组件诞生，方便用户操作。forwardRef 是用来指定 object ref 的活动范围。当然这东西与 HOC 也有关，这个有机会也再分享详述。总之，ref 与 context 一样，从组件中解耦出来。</p> <p>https://zhuanlan.zhihu.com/p/34604934</p> <h3 id="this-refs"><a href="#this-refs" aria-hidden="true" class="header-anchor">#</a> this.refs</h3> <blockquote><p>🗑 该 API 在未来版本将被废弃</p></blockquote> <p>在 React v16.3 之前，ref 通过字符串或者回调函数的形式进行获取。</p> <p>在 DOM 元素上传入值为字符串的 ref 属性，开发者就可以获得该 DOM 元素的引用，可以通过 <code>this.refs</code> 对象获取对应的 DOM 元素引用。</p> <p>既然是获取 DOM 元素的引用，那可定要等组件挂载完成才能操作。</p> <p>目前 React 已经不推荐这种写法。主要原因是耗费性能，因为 UI 需要经历多次更新，而字符串引用无法自动跟踪 DOM 的变化，React 要做额外的处理。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>textInput<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>textInput<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><h3 id="callback"><a href="#callback" aria-hidden="true" class="header-anchor">#</a> callback</h3> <p>React 还支持用一个回调接收 DOM 元素的引用。</p> <p>但是记住，回调不可以写成 <code>el =&gt; this.refs.textInput = el</code>，因为 <code>this.refs</code> 是不可以直接进行写操作的。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">ref</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textInput <span class="token operator">=</span> ref<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>父组件可以通过 Props 给子组件传递 <code>ref</code> 的回调函数获取子组件某个 DOM 元素的引用。</p> <p>一旦子组件挂载完毕，就会执行 <code>ref</code> 回调，父组件就得到该子组件某个 DOM 元素的引用。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Search <span class="token keyword">from</span> <span class="token string">'./Search'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">getInputRef</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> ref<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Search</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>getInputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Search</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>getInputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Search<span class="token punctuation">;</span>
</code></pre></div><h3 id="createref"><a href="#createref" aria-hidden="true" class="header-anchor">#</a> CreateRef</h3> <p>CreateRef API 的作用是创建一个 ref 对象。先把 <code>createRef</code> 的执行结果返回给一个实例属性，然后通过该实例属性获得 DOM 元素的引用。</p> <p>❓ <strong>与之前提及的两种创建方式的区别是什么？</strong></p> <p>使用 String 的方式比较局限，不方便于多组件间的传递或动态获取。而使用 Callback 方法是之前比较推荐的方法。但是写起来略显麻烦，而且 Update 过程中有发生清除可能会有多次调用（Callback 收到 <code>null</code>）。</p> <p>💡 <strong>注意事项</strong>：</p> <ul><li><code>createRef</code> 初始化动作要在组件挂载之前，如果是挂载之后初始化，则无法得到 DOM 元素的引用</li> <li>真正的 DOM 元素引用在 <code>current</code> 属性上</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> createRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  textInput <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>出于不可描述的原因，如果你想获取一个子组件的 ref 引用，那么子组件必须是 Class 组件。</p> <p>因为你获取的实际上是子组件的实例，而函数式组件是没有实例的。</p> <p>所有获取 ref 引用的方式，如果想要获取子组件而不是 DOM 元素，子组件都不能是函数式组件。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> createRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./Child'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  childRef <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>childRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><h3 id="forwardref"><a href="#forwardref" aria-hidden="true" class="header-anchor">#</a> ForwardRef</h3> <p>ForwardRef API 充当传递者角色，实际上是容器组件，能够辅助简化嵌套组件、Component 至 Element 间的 <code>ref</code> 传递，能有效避免 <code>this.ref.ref.ref</code> 的问题。向前传递，这就是叫 <code>forwardRef</code> 的原因。</p> <p>需要注意的是，使用 <code>forwardRef</code> 时，该组件必须是函数式组件。原因可能是 React 不想破坏 Class 组件的参考体系。</p> <p>❓ <strong>与之前提及的获取组件 <code>ref</code> 不能使用函数式组件的区别在哪？</strong></p> <p>两者有着本质区别，这里获取的依然是 DOM 元素，只不过跨级了。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Search <span class="token keyword">from</span> <span class="token string">'./Search'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  textInput <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Search</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> forwardRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Search <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Search<span class="token punctuation">;</span>
</code></pre></div><p>事实上，一旦被 <code>forwardRef</code> 包裹的子组件接收到了 ref 参数，它可以继续将 ref 往下传递。</p> <p>之后 ref 就变成了一个普通的 Props，直到它被挂载到某个 DOM 元素的 ref 属性上。</p> <p>其实 ref 回调也是可以跨多级传递的，原理同上。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> createRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Search <span class="token keyword">from</span> <span class="token string">'./Search'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  textInput <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Search</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Input <span class="token keyword">from</span> <span class="token string">'./Input'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Search <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">inputRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Search<span class="token punctuation">;</span>
</code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Input</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>inputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Input<span class="token punctuation">;</span>
</code></pre></div><h3 id="原理机制"><a href="#原理机制" aria-hidden="true" class="header-anchor">#</a> 原理机制</h3> <p>React 将会在组件挂载时将 DOM 元素分配给 <code>current</code> 属性，并且在组件被卸载时，将 <code>current</code> 属性重置为 <code>null</code>。<code>ref</code> 将会在 <code>componentDidMount</code> 和 <code>componentDidUpdate</code> 生命中器钩子前被更新。</p> <p>为防止内存泄漏，当写在一个组件的时候，组件里所有的 Refs 就会变为 <code>null</code>。</p> <hr> <p><strong>参考资料：</strong></p> <ul><li><a href="https://juejin.im/post/5b59287af265da0f601317e3" target="_blank" rel="noopener noreferrer">React ref 的前世今生<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/react-guidebook/mechanism/render.html" class="prev">
          渲染策略
        </a></span> <span class="next"><a href="/react-guidebook/mechanism/portals.html">
          Portals
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/react-guidebook/assets/js/app.260c1e95.js" defer></script><script src="/react-guidebook/assets/js/2.faf5b053.js" defer></script><script src="/react-guidebook/assets/js/44.c75d55fd.js" defer></script>
  </body>
</html>
